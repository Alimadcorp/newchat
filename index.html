<style>#a,#b{display:flex;gap:6px}#a,#f{padding:6px}body,button,html,textarea{background:#000;color:#0f0}#f,button,textarea{border:1px solid #030}@font-face{font-family:GM;src:url("https://corsproxy.io/?url=https://cdn.alimad.co/f/GeistMono.woff2") format("woff2")}body,html{height:100%;margin:0;padding:0;overflow:hidden;font-family:GM,monospace}#a{flex-direction:column;height:100vh}#f{flex:1;overflow-y:auto;overflow-x:hidden;background:linear-gradient(#001000,#000);font-size:14px}.msg{padding:4px 6px;margin:4px 0;word-break:break-word;max-width:90%}.me{margin-left:auto;color:#0f0}.other{color:#6f6}.meta{font-size:10px;opacity:.6;margin-bottom:2px}button,textarea{padding:8px;font:inherit;border-radius:0}textarea{flex:1;resize:none;height:42px}button{cursor:pointer;white-space:nowrap}button:hover{border-color:#0f0}</style><div id=a><div id=b><textarea id=c placeholder="> enter…"></textarea><button id=i>i</button></div><div id=f></div></div><script>const qp=new URLSearchParams(location.search);let user=qp.get("channel");user||(user=prompt("channel (username)")||"guest"+Math.random().toString(36).slice(2)),user=user.trim();const f=document.getElementById("f"),c=document.getElementById("c"),i=document.getElementById("i");let seen=new Set,polling=5e3;const safe=e=>String(e).replace(/[&<>]/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;"})[e]);function timeAgo(e){if(!e)return"";let t=new Date(e),n=(Date.now()-t.getTime())/1e3;return isNaN(n)?"":n<10?"just now":n<60?Math.floor(n)+"s ago":(n/=60)<60?Math.floor(n)+"m ago":(n/=60)<24?Math.floor(n)+"h ago":Math.floor(n/24)+"d ago"}function render(e){let t="",n="",l="",s="";"string"==typeof e?n=e:e&&"object"==typeof e?(n=e.text??e.msg??e.message??JSON.stringify(e),t=e.user??e.from??e.name??"",s=e.ip??"",l=e.time??""):n=String(e);let a=t+n+l+s;if(seen.has(a))return;seen.add(a);let r=document.createElement("div");r.className="msg "+(t===user?"me":"other");let o=timeAgo(l),u=[];t&&u.push(safe(t)),s&&u.push(safe(s)),o&&u.push(o);let g=u.length?"<span class=meta>["+u.join(" • ")+"]</span><br>":"";r.innerHTML=g+safe(n),f.appendChild(r),f.scrollTop=f.scrollHeight}async function pull(){try{let e="channel="+encodeURIComponent("chat:"+user),t=await fetch("https://log.alimad.co/api/pull?pwd=PASSWORDISBANANA&"+e,{cache:"no-store"});if(!t.ok)return;let n=await t.json(),l=n?.logs??n?.data??n;Array.isArray(l)?l.forEach(render):l&&"object"==typeof l&&Object.values(l).forEach(render)}catch{}}async function sendMsg(e){if(!e.trim())return;let t="channel="+encodeURIComponent("chat:"+user)+"&text="+encodeURIComponent(e);try{await fetch("https://log.alimad.co/api/log?"+t),c.value="",pull()}catch{}}i.onclick=()=>sendMsg(c.value),c.addEventListener("keydown",e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),sendMsg(c.value))}),pull(),setInterval(pull,polling)</script>
